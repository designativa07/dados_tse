<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Perfil do Eleitor - Santa Catarina</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
    <link rel="stylesheet" href="eleitor-styles.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .header h1 {
            color: #2c3e50;
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            color: #7f8c8d;
            font-size: 1.1rem;
            margin-bottom: 20px;
        }

        .nav-menu {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .nav-menu a {
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
            text-decoration: none;
            padding: 12px 24px;
            border-radius: 25px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
        }

        .nav-menu a:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(52, 152, 219, 0.4);
        }

        .nav-menu a.active {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            box-shadow: 0 4px 15px rgba(231, 76, 60, 0.3);
        }

        .controls {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
        }

        .controls h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.3rem;
        }

        .filter-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .filter-item {
            display: flex;
            flex-direction: column;
        }

        .filter-item label {
            color: #34495e;
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 0.9rem;
        }

        .filter-item select {
            padding: 12px;
            border: 2px solid #e0e6ed;
            border-radius: 10px;
            font-size: 1rem;
            background: white;
            transition: all 0.3s ease;
        }

        .filter-item select:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-card h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .stat-card .icon {
            width: 24px;
            height: 24px;
            background: linear-gradient(45deg, #3498db, #2980b9);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.8rem;
        }

        .chart-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
        }

        .chart-container h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.3rem;
            text-align: center;
        }

        .chart-wrapper {
            position: relative;
            height: 400px;
            margin-bottom: 20px;
        }

        .comparison-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .comparison-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
        }

        .comparison-card h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.2rem;
            text-align: center;
        }

        .comparison-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .year-stat {
            text-align: center;
            padding: 15px;
            border-radius: 10px;
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
        }

        .year-stat h4 {
            color: #495057;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        .year-stat .number {
            font-size: 2rem;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .year-stat .percentage {
            font-size: 1rem;
            color: #6c757d;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #7f8c8d;
            font-size: 1.1rem;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error {
            background: #e74c3c;
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
        }

        .data-info {
            background: rgba(52, 152, 219, 0.1);
            border: 1px solid rgba(52, 152, 219, 0.3);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            color: #2c3e50;
        }

        .data-info h4 {
            margin-bottom: 10px;
            color: #2980b9;
        }

        .data-info p {
            margin-bottom: 5px;
            font-size: 0.9rem;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .nav-menu {
                flex-direction: column;
                align-items: center;
            }
            
            .filter-group {
                grid-template-columns: 1fr;
            }
            
            .comparison-grid {
                grid-template-columns: 1fr;
            }
            
            .comparison-stats {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üó≥Ô∏è Perfil do Eleitor</h1>
            <p>An√°lise comparativa do perfil dos eleitores de Santa Catarina (2018 vs 2022)</p>
            <div class="nav-menu">
                <a href="index.html">üè† In√≠cio</a>
                <a href="Candidatos.html">üë• Candidatos</a>
                <a href="Eleitor.html" class="active">üó≥Ô∏è Eleitor</a>
                <a href="Resultados.html">üìä Resultados</a>
            </div>
        </div>

        <div class="controls">
            <h3>üîç Filtros de An√°lise</h3>
            <div class="filter-group">
                <div class="filter-item">
                    <label for="municipio">Munic√≠pio:</label>
                    <select id="municipio">
                        <option value="">Todos os munic√≠pios</option>
                    </select>
                </div>
                <div class="filter-item">
                    <label for="zona">Zona Eleitoral:</label>
                    <select id="zona">
                        <option value="">Todas as zonas</option>
                    </select>
                </div>
                <div class="filter-item">
                    <label for="ano">Ano da Elei√ß√£o:</label>
                    <select id="ano">
                        <option value="">Ambos os anos</option>
                        <option value="2018">2018</option>
                        <option value="2022">2022</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Abas de An√°lise -->
        <div class="analysis-tabs">
            <div class="tab-buttons">
                <button class="tab-btn active" data-tab="comparativo">
                    <i class="fas fa-balance-scale"></i>
                    Comparativo (2018 vs 2022)
                </button>
                <button class="tab-btn" data-tab="individual-2018">
                    <i class="fas fa-calendar-alt"></i>
                    An√°lise Individual 2018
                </button>
                <button class="tab-btn" data-tab="individual-2022">
                    <i class="fas fa-calendar-alt"></i>
                    An√°lise Individual 2022
                </button>
            </div>
        </div>

        <div class="data-info">
            <h4>üìã Informa√ß√µes sobre os Dados</h4>
            <p><strong>Fonte:</strong> Tribunal Superior Eleitoral (TSE)</p>
            <p><strong>Per√≠odo:</strong> Elei√ß√µes de 2018 e 2022</p>
            <p><strong>Escopo:</strong> Estado de Santa Catarina</p>
            <p><strong>Dados:</strong> Perfil dos eleitores por se√ß√£o eleitoral</p>
        </div>

        <div id="loading" class="loading">
            <div class="spinner"></div>
            Carregando dados dos eleitores...
        </div>

        <div id="content" style="display: none;">
            <!-- Aba Comparativo -->
            <div id="tab-comparativo" class="tab-content active">
                <!-- Estat√≠sticas Gerais -->
                <div class="stats-grid" id="statsGrid">
                    <!-- Ser√° preenchido dinamicamente -->
                </div>

                <!-- Gr√°ficos Comparativos -->
                <div class="comparison-grid">
                    <div class="comparison-card">
                        <h3>üë• Distribui√ß√£o por G√™nero</h3>
                        <div class="chart-wrapper">
                            <canvas id="generoChart"></canvas>
                        </div>
                    </div>

                    <div class="comparison-card">
                        <h3>üìö Distribui√ß√£o por Escolaridade</h3>
                        <div class="chart-wrapper">
                            <canvas id="escolaridadeChart"></canvas>
                        </div>
                    </div>

                    <div class="comparison-card">
                        <h3>üéÇ Distribui√ß√£o por Faixa Et√°ria</h3>
                        <div class="chart-wrapper">
                            <canvas id="idadeChart"></canvas>
                        </div>
                    </div>

                    <div class="comparison-card">
                        <h3>üíç Distribui√ß√£o por Estado Civil</h3>
                        <div class="chart-wrapper">
                            <canvas id="estadoCivilChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- An√°lise Detalhada -->
                <div class="chart-container">
                    <h3>üìà Evolu√ß√£o do Perfil Eleitoral (2018 vs 2022)</h3>
                    <div class="chart-wrapper">
                        <canvas id="evolucaoChart"></canvas>
                    </div>
                </div>

                <!-- Compara√ß√£o por Munic√≠pio -->
                <div class="chart-container">
                    <h3>üèôÔ∏è Top 10 Munic√≠pios por N√∫mero de Eleitores</h3>
                    <div class="chart-wrapper">
                        <canvas id="municipiosChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Aba Individual 2018 -->
            <div id="tab-individual-2018" class="tab-content">
                <div class="individual-header">
                    <h2>üìä An√°lise Individual - Elei√ß√£o 2018</h2>
                    <p>Perfil detalhado dos eleitores de Santa Catarina em 2018</p>
                </div>

                <!-- Estat√≠sticas 2018 -->
                <div class="stats-grid" id="stats2018">
                    <!-- Ser√° preenchido dinamicamente -->
                </div>

                <!-- Gr√°ficos Individuais 2018 -->
                <div class="individual-grid">
                    <div class="individual-card">
                        <h3>üë• Distribui√ß√£o por G√™nero</h3>
                        <div class="chart-wrapper">
                            <canvas id="genero2018Chart"></canvas>
                        </div>
                    </div>

                    <div class="individual-card">
                        <h3>üìö Distribui√ß√£o por Escolaridade</h3>
                        <div class="chart-wrapper">
                            <canvas id="escolaridade2018Chart"></canvas>
                        </div>
                    </div>

                    <div class="individual-card">
                        <h3>üéÇ Distribui√ß√£o por Faixa Et√°ria</h3>
                        <div class="chart-wrapper">
                            <canvas id="idade2018Chart"></canvas>
                        </div>
                    </div>

                    <div class="individual-card">
                        <h3>üíç Distribui√ß√£o por Estado Civil</h3>
                        <div class="chart-wrapper">
                            <canvas id="estadoCivil2018Chart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- An√°lise por Munic√≠pio 2018 -->
                <div class="chart-container">
                    <h3>üèôÔ∏è Top 15 Munic√≠pios por N√∫mero de Eleitores (2018)</h3>
                    <div class="chart-wrapper">
                        <canvas id="municipios2018Chart"></canvas>
                    </div>
                </div>

                <!-- An√°lise por Zona Eleitoral 2018 -->
                <div class="chart-container">
                    <h3>üó∫Ô∏è Distribui√ß√£o por Zona Eleitoral (2018)</h3>
                    <div class="chart-wrapper">
                        <canvas id="zonas2018Chart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Aba Individual 2022 -->
            <div id="tab-individual-2022" class="tab-content">
                <div class="individual-header">
                    <h2>üìä An√°lise Individual - Elei√ß√£o 2022</h2>
                    <p>Perfil detalhado dos eleitores de Santa Catarina em 2022</p>
                </div>

                <!-- Estat√≠sticas 2022 -->
                <div class="stats-grid" id="stats2022">
                    <!-- Ser√° preenchido dinamicamente -->
                </div>

                <!-- Gr√°ficos Individuais 2022 -->
                <div class="individual-grid">
                    <div class="individual-card">
                        <h3>üë• Distribui√ß√£o por G√™nero</h3>
                        <div class="chart-wrapper">
                            <canvas id="genero2022Chart"></canvas>
                        </div>
                    </div>

                    <div class="individual-card">
                        <h3>üìö Distribui√ß√£o por Escolaridade</h3>
                        <div class="chart-wrapper">
                            <canvas id="escolaridade2022Chart"></canvas>
                        </div>
                    </div>

                    <div class="individual-card">
                        <h3>üéÇ Distribui√ß√£o por Faixa Et√°ria</h3>
                        <div class="chart-wrapper">
                            <canvas id="idade2022Chart"></canvas>
                        </div>
                    </div>

                    <div class="individual-card">
                        <h3>üíç Distribui√ß√£o por Estado Civil</h3>
                        <div class="chart-wrapper">
                            <canvas id="estadoCivil2022Chart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- An√°lise por Munic√≠pio 2022 -->
                <div class="chart-container">
                    <h3>üèôÔ∏è Top 15 Munic√≠pios por N√∫mero de Eleitores (2022)</h3>
                    <div class="chart-wrapper">
                        <canvas id="municipios2022Chart"></canvas>
                    </div>
                </div>

                <!-- An√°lise por Zona Eleitoral 2022 -->
                <div class="chart-container">
                    <h3>üó∫Ô∏è Distribui√ß√£o por Zona Eleitoral (2022)</h3>
                    <div class="chart-wrapper">
                        <canvas id="zonas2022Chart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Vari√°veis globais para armazenar os dados
        let dados2018 = [];
        let dados2022 = [];
        let dadosFiltrados = { 2018: [], 2022: [] };
        let municipios = new Set();
        let zonas = new Set();

        // Cores para os gr√°ficos
        const cores = {
            2018: '#3498db',
            2022: '#e74c3c',
            genero: ['#3498db', '#e74c3c'],
            escolaridade: ['#2ecc71', '#f39c12', '#9b59b6', '#1abc9c', '#34495e', '#e67e22'],
            idade: ['#3498db', '#2ecc71', '#f39c12', '#e74c3c', '#9b59b6', '#1abc9c'],
            estadoCivil: ['#3498db', '#2ecc71', '#f39c12', '#e74c3c', '#9b59b6']
        };

        // Fun√ß√£o para carregar dados CSV
        async function carregarDados() {
            try {
                // Carregar dados de 2018
                const response2018 = await fetch('perfil_eleitor_secao_2018_SC/perfil_eleitor_secao_2018_SC.csv');
                const csv2018 = await response2018.text();
                dados2018 = Papa.parse(csv2018, { header: true, delimiter: ';' }).data;

                // Carregar dados de 2022
                const response2022 = await fetch('perfil_eleitor_secao_2022_SC/perfil_eleitor_secao_2022_SC.csv');
                const csv2022 = await response2022.text();
                dados2022 = Papa.parse(csv2022, { header: true, delimiter: ';' }).data;

                // Processar dados
                processarDados();
                
                // Atualizar filtros
                atualizarFiltros();
                
                // Gerar visualiza√ß√µes
                gerarVisualizacoes();
                
                // Mostrar conte√∫do
                document.getElementById('loading').style.display = 'none';
                document.getElementById('content').style.display = 'block';

            } catch (error) {
                console.error('Erro ao carregar dados:', error);
                document.getElementById('loading').innerHTML = 
                    '<div class="error">Erro ao carregar os dados. Verifique se os arquivos CSV est√£o dispon√≠veis.</div>';
            }
        }

        // Fun√ß√£o para processar os dados
        function processarDados() {
            // Limpar dados inv√°lidos
            dados2018 = dados2018.filter(row => row.QT_ELEITORES_PERFIL && !isNaN(parseInt(row.QT_ELEITORES_PERFIL)));
            dados2022 = dados2022.filter(row => row.QT_ELEITORES_PERFIL && !isNaN(parseInt(row.QT_ELEITORES_PERFIL)));

            // Coletar munic√≠pios e zonas √∫nicos
            dados2018.forEach(row => {
                municipios.add(row.NM_MUNICIPIO);
                zonas.add(row.NR_ZONA);
            });
            dados2022.forEach(row => {
                municipios.add(row.NM_MUNICIPIO);
                zonas.add(row.NR_ZONA);
            });

            // Aplicar filtros iniciais
            aplicarFiltros();
        }

        // Fun√ß√£o para atualizar os filtros
        function atualizarFiltros() {
            const municipioSelect = document.getElementById('municipio');
            const zonaSelect = document.getElementById('zona');

            // Limpar op√ß√µes existentes
            municipioSelect.innerHTML = '<option value="">Todos os munic√≠pios</option>';
            zonaSelect.innerHTML = '<option value="">Todas as zonas</option>';

            // Adicionar munic√≠pios
            Array.from(municipios).sort().forEach(municipio => {
                const option = document.createElement('option');
                option.value = municipio;
                option.textContent = municipio;
                municipioSelect.appendChild(option);
            });

            // Adicionar zonas
            Array.from(zonas).sort((a, b) => parseInt(a) - parseInt(b)).forEach(zona => {
                const option = document.createElement('option');
                option.value = zona;
                option.textContent = `Zona ${zona}`;
                zonaSelect.appendChild(option);
            });

            // Adicionar event listeners
            municipioSelect.addEventListener('change', aplicarFiltros);
            zonaSelect.addEventListener('change', aplicarFiltros);
            document.getElementById('ano').addEventListener('change', aplicarFiltros);
        }

        // Fun√ß√£o para aplicar filtros
        function aplicarFiltros() {
            const municipioFiltro = document.getElementById('municipio').value;
            const zonaFiltro = document.getElementById('zona').value;
            const anoFiltro = document.getElementById('ano').value;

            // Filtrar dados de 2018
            dadosFiltrados[2018] = dados2018.filter(row => {
                return (!municipioFiltro || row.NM_MUNICIPIO === municipioFiltro) &&
                       (!zonaFiltro || row.NR_ZONA === zonaFiltro);
            });

            // Filtrar dados de 2022
            dadosFiltrados[2022] = dados2022.filter(row => {
                return (!municipioFiltro || row.NM_MUNICIPIO === municipioFiltro) &&
                       (!zonaFiltro || row.NR_ZONA === zonaFiltro);
            });

            // Gerar visualiza√ß√µes atualizadas
            gerarVisualizacoes();
        }

        // Fun√ß√£o para gerar todas as visualiza√ß√µes
        function gerarVisualizacoes() {
            gerarEstatisticas();
            gerarGraficoGenero();
            gerarGraficoEscolaridade();
            gerarGraficoIdade();
            gerarGraficoEstadoCivil();
            gerarGraficoEvolucao();
            gerarGraficoMunicipios();
        }

        // Fun√ß√£o para gerar estat√≠sticas gerais
        function gerarEstatisticas() {
            const statsGrid = document.getElementById('statsGrid');
            
            // Calcular estat√≠sticas
            const total2018 = dadosFiltrados[2018].reduce((sum, row) => sum + parseInt(row.QT_ELEITORES_PERFIL), 0);
            const total2022 = dadosFiltrados[2022].reduce((sum, row) => sum + parseInt(row.QT_ELEITORES_PERFIL), 0);
            const crescimento = total2022 > 0 && total2018 > 0 ? ((total2022 - total2018) / total2018 * 100).toFixed(1) : 0;

            // Calcular estat√≠sticas por g√™nero
            const genero2018 = calcularEstatisticasPorCategoria(dadosFiltrados[2018], 'DS_GENERO');
            const genero2022 = calcularEstatisticasPorCategoria(dadosFiltrados[2022], 'DS_GENERO');

            // Calcular estat√≠sticas por escolaridade
            const escolaridade2018 = calcularEstatisticasPorCategoria(dadosFiltrados[2018], 'DS_GRAU_ESCOLARIDADE');
            const escolaridade2022 = calcularEstatisticasPorCategoria(dadosFiltrados[2022], 'DS_GRAU_ESCOLARIDADE');

            statsGrid.innerHTML = `
                <div class="stat-card">
                    <h3><div class="icon">üë•</div>Total de Eleitores</h3>
                    <div class="comparison-stats">
                        <div class="year-stat">
                            <h4>2018</h4>
                            <div class="number">${total2018.toLocaleString()}</div>
                        </div>
                        <div class="year-stat">
                            <h4>2022</h4>
                            <div class="number">${total2022.toLocaleString()}</div>
                            <div class="percentage">${crescimento > 0 ? '+' : ''}${crescimento}%</div>
                        </div>
                    </div>
                </div>

                <div class="stat-card">
                    <h3><div class="icon">üë®‚Äçüë©‚Äçüëß‚Äçüë¶</div>Distribui√ß√£o por G√™nero</h3>
                    <div class="comparison-stats">
                        <div class="year-stat">
                            <h4>2018</h4>
                            <div class="number">${genero2018['MASCULINO'] ? genero2018['MASCULINO'].toLocaleString() : '0'}</div>
                            <div class="percentage">Masculino</div>
                        </div>
                        <div class="year-stat">
                            <h4>2022</h4>
                            <div class="number">${genero2022['MASCULINO'] ? genero2022['MASCULINO'].toLocaleString() : '0'}</div>
                            <div class="percentage">Masculino</div>
                        </div>
                    </div>
                </div>

                <div class="stat-card">
                    <h3><div class="icon">üìö</div>Escolaridade M√©dia</h3>
                    <div class="comparison-stats">
                        <div class="year-stat">
                            <h4>2018</h4>
                            <div class="number">${calcularEscolaridadeMedia(escolaridade2018)}</div>
                            <div class="percentage">anos</div>
                        </div>
                        <div class="year-stat">
                            <h4>2022</h4>
                            <div class="number">${calcularEscolaridadeMedia(escolaridade2022)}</div>
                            <div class="percentage">anos</div>
                        </div>
                    </div>
                </div>

                <div class="stat-card">
                    <h3><div class="icon">üèôÔ∏è</div>Munic√≠pios</h3>
                    <div class="comparison-stats">
                        <div class="year-stat">
                            <h4>2018</h4>
                            <div class="number">${new Set(dadosFiltrados[2018].map(row => row.NM_MUNICIPIO)).size}</div>
                            <div class="percentage">munic√≠pios</div>
                        </div>
                        <div class="year-stat">
                            <h4>2022</h4>
                            <div class="number">${new Set(dadosFiltrados[2022].map(row => row.NM_MUNICIPIO)).size}</div>
                            <div class="percentage">munic√≠pios</div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Fun√ß√£o auxiliar para calcular estat√≠sticas por categoria
        function calcularEstatisticasPorCategoria(dados, categoria) {
            const stats = {};
            dados.forEach(row => {
                const valor = row[categoria];
                const quantidade = parseInt(row.QT_ELEITORES_PERFIL);
                if (valor && valor !== '#NE' && valor !== '-3') {
                    stats[valor] = (stats[valor] || 0) + quantidade;
                }
            });
            return stats;
        }

        // Fun√ß√£o para calcular escolaridade m√©dia
        function calcularEscolaridadeMedia(escolaridadeStats) {
            const niveis = {
                'ANALFABETO': 0,
                'L√ä E ESCREVE': 1,
                'ENSINO FUNDAMENTAL INCOMPLETO': 4,
                'ENSINO FUNDAMENTAL COMPLETO': 8,
                'ENSINO M√âDIO INCOMPLETO': 11,
                'ENSINO M√âDIO COMPLETO': 11,
                'SUPERIOR INCOMPLETO': 14,
                'SUPERIOR COMPLETO': 16
            };

            let totalEleitores = 0;
            let somaEscolaridade = 0;

            Object.entries(escolaridadeStats).forEach(([nivel, quantidade]) => {
                if (niveis[nivel] !== undefined) {
                    totalEleitores += quantidade;
                    somaEscolaridade += niveis[nivel] * quantidade;
                }
            });

            return totalEleitores > 0 ? (somaEscolaridade / totalEleitores).toFixed(1) : '0.0';
        }

        // Fun√ß√£o para gerar gr√°fico de g√™nero
        function gerarGraficoGenero() {
            const ctx = document.getElementById('generoChart').getContext('2d');
            
            const genero2018 = calcularEstatisticasPorCategoria(dadosFiltrados[2018], 'DS_GENERO');
            const genero2022 = calcularEstatisticasPorCategoria(dadosFiltrados[2022], 'DS_GENERO');

            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Masculino', 'Feminino'],
                    datasets: [{
                        label: '2018',
                        data: [genero2018['MASCULINO'] || 0, genero2018['FEMININO'] || 0],
                        backgroundColor: ['#3498db', '#e74c3c'],
                        borderWidth: 2
                    }, {
                        label: '2022',
                        data: [genero2022['MASCULINO'] || 0, genero2022['FEMININO'] || 0],
                        backgroundColor: ['#2980b9', '#c0392b'],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                usePointStyle: true
                            }
                        }
                    }
                }
            });
        }

        // Fun√ß√£o para gerar gr√°fico de escolaridade
        function gerarGraficoEscolaridade() {
            const ctx = document.getElementById('escolaridadeChart').getContext('2d');
            
            const escolaridade2018 = calcularEstatisticasPorCategoria(dadosFiltrados[2018], 'DS_GRAU_ESCOLARIDADE');
            const escolaridade2022 = calcularEstatisticasPorCategoria(dadosFiltrados[2022], 'DS_GRAU_ESCOLARIDADE');

            const niveis = Object.keys({...escolaridade2018, ...escolaridade2022});

            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: niveis,
                    datasets: [{
                        label: '2018',
                        data: niveis.map(nivel => escolaridade2018[nivel] || 0),
                        backgroundColor: '#3498db',
                        borderColor: '#2980b9',
                        borderWidth: 1
                    }, {
                        label: '2022',
                        data: niveis.map(nivel => escolaridade2022[nivel] || 0),
                        backgroundColor: '#e74c3c',
                        borderColor: '#c0392b',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                padding: 20,
                                usePointStyle: true
                            }
                        }
                    }
                }
            });
        }

        // Fun√ß√£o para gerar gr√°fico de idade
        function gerarGraficoIdade() {
            const ctx = document.getElementById('idadeChart').getContext('2d');
            
            const idade2018 = calcularEstatisticasPorCategoria(dadosFiltrados[2018], 'DS_FAIXA_ETARIA');
            const idade2022 = calcularEstatisticasPorCategoria(dadosFiltrados[2022], 'DS_FAIXA_ETARIA');

            const faixas = Object.keys({...idade2018, ...idade2022}).sort();

            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: faixas,
                    datasets: [{
                        label: '2018',
                        data: faixas.map(faixa => idade2018[faixa] || 0),
                        borderColor: '#3498db',
                        backgroundColor: 'rgba(52, 152, 219, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4
                    }, {
                        label: '2022',
                        data: faixas.map(faixa => idade2022[faixa] || 0),
                        borderColor: '#e74c3c',
                        backgroundColor: 'rgba(231, 76, 60, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                padding: 20,
                                usePointStyle: true
                            }
                        }
                    }
                }
            });
        }

        // Fun√ß√£o para gerar gr√°fico de estado civil
        function gerarGraficoEstadoCivil() {
            const ctx = document.getElementById('estadoCivilChart').getContext('2d');
            
            const estadoCivil2018 = calcularEstatisticasPorCategoria(dadosFiltrados[2018], 'DS_ESTADO_CIVIL');
            const estadoCivil2022 = calcularEstatisticasPorCategoria(dadosFiltrados[2022], 'DS_ESTADO_CIVIL');

            const estados = Object.keys({...estadoCivil2018, ...estadoCivil2022});

            new Chart(ctx, {
                type: 'polarArea',
                data: {
                    labels: estados,
                    datasets: [{
                        label: '2018',
                        data: estados.map(estado => estadoCivil2018[estado] || 0),
                        backgroundColor: [
                            'rgba(52, 152, 219, 0.8)',
                            'rgba(46, 204, 113, 0.8)',
                            'rgba(243, 156, 18, 0.8)',
                            'rgba(231, 76, 60, 0.8)',
                            'rgba(155, 89, 182, 0.8)'
                        ],
                        borderColor: [
                            '#3498db',
                            '#2ecc71',
                            '#f39c12',
                            '#e74c3c',
                            '#9b59b6'
                        ],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                usePointStyle: true
                            }
                        }
                    }
                }
            });
        }

        // Fun√ß√£o para gerar gr√°fico de evolu√ß√£o
        function gerarGraficoEvolucao() {
            const ctx = document.getElementById('evolucaoChart').getContext('2d');
            
            const total2018 = dadosFiltrados[2018].reduce((sum, row) => sum + parseInt(row.QT_ELEITORES_PERFIL), 0);
            const total2022 = dadosFiltrados[2022].reduce((sum, row) => sum + parseInt(row.QT_ELEITORES_PERFIL), 0);

            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['2018', '2022'],
                    datasets: [{
                        label: 'Total de Eleitores',
                        data: [total2018, total2022],
                        backgroundColor: ['#3498db', '#e74c3c'],
                        borderColor: ['#2980b9', '#c0392b'],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }

        // Fun√ß√£o para gerar gr√°fico de munic√≠pios
        function gerarGraficoMunicipios() {
            const ctx = document.getElementById('municipiosChart').getContext('2d');
            
            // Calcular totais por munic√≠pio para ambos os anos
            const municipios2018 = {};
            const municipios2022 = {};

            dadosFiltrados[2018].forEach(row => {
                const municipio = row.NM_MUNICIPIO;
                municipios2018[municipio] = (municipios2018[municipio] || 0) + parseInt(row.QT_ELEITORES_PERFIL);
            });

            dadosFiltrados[2022].forEach(row => {
                const municipio = row.NM_MUNICIPIO;
                municipios2022[municipio] = (municipios2022[municipio] || 0) + parseInt(row.QT_ELEITORES_PERFIL);
            });

            // Pegar os top 10 munic√≠pios de 2022
            const topMunicipios = Object.entries(municipios2022)
                .sort(([,a], [,b]) => b - a)
                .slice(0, 10)
                .map(([municipio]) => municipio);

            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: topMunicipios,
                    datasets: [{
                        label: '2018',
                        data: topMunicipios.map(municipio => municipios2018[municipio] || 0),
                        backgroundColor: '#3498db',
                        borderColor: '#2980b9',
                        borderWidth: 1
                    }, {
                        label: '2022',
                        data: topMunicipios.map(municipio => municipios2022[municipio] || 0),
                        backgroundColor: '#e74c3c',
                        borderColor: '#c0392b',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                padding: 20,
                                usePointStyle: true
                            }
                        }
                    }
                }
            });
        }

        // Fun√ß√£o para atualizar gr√°ficos baseado na aba selecionada
        function atualizarGraficos(aba) {
            if (aba === 'comparativo') {
                gerarGraficoGenero();
                gerarGraficoEscolaridade();
                gerarGraficoIdade();
                gerarGraficoEstadoCivil();
                gerarGraficoEvolucao();
                gerarGraficoMunicipios();
            } else if (aba === 'individual-2018') {
                criarGraficosIndividuais2018();
            } else if (aba === 'individual-2022') {
                criarGraficosIndividuais2022();
            }
        }

        // Fun√ß√£o para criar gr√°ficos individuais de 2018
        function criarGraficosIndividuais2018() {
            if (dados2018.length === 0) return;

            // Estat√≠sticas gerais 2018
            atualizarEstatisticasIndividuais('stats2018', dados2018, '2018');

            // Gr√°fico de g√™nero 2018
            criarGraficoIndividualGenero('genero2018Chart', dados2018, '2018');

            // Gr√°fico de escolaridade 2018
            criarGraficoIndividualEscolaridade('escolaridade2018Chart', dados2018, '2018');

            // Gr√°fico de idade 2018
            criarGraficoIndividualIdade('idade2018Chart', dados2018, '2018');

            // Gr√°fico de estado civil 2018
            criarGraficoIndividualEstadoCivil('estadoCivil2018Chart', dados2018, '2018');

            // Gr√°fico de munic√≠pios 2018
            criarGraficoMunicipiosIndividual('municipios2018Chart', dados2018, '2018');

            // Gr√°fico de zonas 2018
            criarGraficoZonasIndividual('zonas2018Chart', dados2018, '2018');
        }

        // Fun√ß√£o para criar gr√°ficos individuais de 2022
        function criarGraficosIndividuais2022() {
            if (dados2022.length === 0) return;

            // Estat√≠sticas gerais 2022
            atualizarEstatisticasIndividuais('stats2022', dados2022, '2022');

            // Gr√°fico de g√™nero 2022
            criarGraficoIndividualGenero('genero2022Chart', dados2022, '2022');

            // Gr√°fico de escolaridade 2022
            criarGraficoIndividualEscolaridade('escolaridade2022Chart', dados2022, '2022');

            // Gr√°fico de idade 2022
            criarGraficoIndividualIdade('idade2022Chart', dados2022, '2022');

            // Gr√°fico de estado civil 2022
            criarGraficoIndividualEstadoCivil('estadoCivil2022Chart', dados2022, '2022');

            // Gr√°fico de munic√≠pios 2022
            criarGraficoMunicipiosIndividual('municipios2022Chart', dados2022, '2022');

            // Gr√°fico de zonas 2022
            criarGraficoZonasIndividual('zonas2022Chart', dados2022, '2022');
        }

        // Fun√ß√£o para atualizar estat√≠sticas individuais
        function atualizarEstatisticasIndividuais(containerId, dados, ano) {
            const container = document.getElementById(containerId);
            if (!container) return;

            const totalEleitores = dados.reduce((sum, row) => sum + parseInt(row.QT_ELEITORES_PERFIL), 0);
            const totalSecoes = dados.length;
            const municipiosUnicos = new Set(dados.map(row => row.NM_MUNICIPIO)).size;
            const zonasUnicas = new Set(dados.map(row => row.NR_ZONA)).size;

            container.innerHTML = `
                <div class="stat-card">
                    <div class="stat-icon">üë•</div>
                    <div class="stat-content">
                        <h3>Total de Eleitores</h3>
                        <div class="stat-number">${totalEleitores.toLocaleString('pt-BR')}</div>
                        <div class="stat-label">Elei√ß√£o ${ano}</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üèõÔ∏è</div>
                    <div class="stat-content">
                        <h3>Se√ß√µes Eleitorais</h3>
                        <div class="stat-number">${totalSecoes.toLocaleString('pt-BR')}</div>
                        <div class="stat-label">Total de se√ß√µes</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üèôÔ∏è</div>
                    <div class="stat-content">
                        <h3>Munic√≠pios</h3>
                        <div class="stat-number">${municipiosUnicos}</div>
                        <div class="stat-label">Munic√≠pios com dados</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üó∫Ô∏è</div>
                    <div class="stat-content">
                        <h3>Zonas Eleitorais</h3>
                        <div class="stat-number">${zonasUnicas}</div>
                        <div class="stat-label">Zonas eleitorais</div>
                    </div>
                </div>
            `;
        }

        // Fun√ß√£o para criar gr√°fico individual de g√™nero
        function criarGraficoIndividualGenero(canvasId, dados, ano) {
            const ctx = document.getElementById(canvasId);
            if (!ctx) return;

            const generos = {};
            dados.forEach(row => {
                const genero = row.DS_GENERO;
                const eleitores = parseInt(row.QT_ELEITORES_PERFIL);
                generos[genero] = (generos[genero] || 0) + eleitores;
            });

            const labels = Object.keys(generos);
            const values = Object.values(generos);
            const colors = ['#FF6384', '#36A2EB', '#FFCE56'];

            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: values,
                        backgroundColor: colors.slice(0, labels.length),
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: `Distribui√ß√£o por G√™nero - ${ano}`,
                            font: { size: 16, weight: 'bold' }
                        },
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                font: { size: 12 }
                            }
                        }
                    }
                }
            });
        }

        // Fun√ß√£o para criar gr√°fico individual de escolaridade
        function criarGraficoIndividualEscolaridade(canvasId, dados, ano) {
            const ctx = document.getElementById(canvasId);
            if (!ctx) return;

            const escolaridades = {};
            dados.forEach(row => {
                const escolaridade = row.DS_GRAU_ESCOLARIDADE || 'N√£o informado';
                const eleitores = parseInt(row.QT_ELEITORES_PERFIL);
                escolaridades[escolaridade] = (escolaridades[escolaridade] || 0) + eleitores;
            });

            const labels = Object.keys(escolaridades);
            const values = Object.values(escolaridades);

            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: `Eleitores ${ano}`,
                        data: values,
                        backgroundColor: '#36A2EB',
                        borderColor: '#1E88E5',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: `Distribui√ß√£o por Escolaridade - ${ano}`,
                            font: { size: 16, weight: 'bold' }
                        },
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return value.toLocaleString('pt-BR');
                                }
                            }
                        }
                    }
                }
            });
        }

        // Fun√ß√£o para criar gr√°fico individual de idade
        function criarGraficoIndividualIdade(canvasId, dados, ano) {
            const ctx = document.getElementById(canvasId);
            if (!ctx) return;

            const idades = {};
            dados.forEach(row => {
                const idade = row.DS_FAIXA_ETARIA || 'N√£o informado';
                const eleitores = parseInt(row.QT_ELEITORES_PERFIL);
                idades[idade] = (idades[idade] || 0) + eleitores;
            });

            const labels = Object.keys(idades);
            const values = Object.values(idades);

            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: `Eleitores ${ano}`,
                        data: values,
                        backgroundColor: '#4CAF50',
                        borderColor: '#388E3C',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: `Distribui√ß√£o por Faixa Et√°ria - ${ano}`,
                            font: { size: 16, weight: 'bold' }
                        },
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return value.toLocaleString('pt-BR');
                                }
                            }
                        }
                    }
                }
            });
        }

        // Fun√ß√£o para criar gr√°fico individual de estado civil
        function criarGraficoIndividualEstadoCivil(canvasId, dados, ano) {
            const ctx = document.getElementById(canvasId);
            if (!ctx) return;

            const estadosCivis = {};
            dados.forEach(row => {
                const estadoCivil = row.DS_ESTADO_CIVIL || 'N√£o informado';
                const eleitores = parseInt(row.QT_ELEITORES_PERFIL);
                estadosCivis[estadoCivil] = (estadosCivis[estadoCivil] || 0) + eleitores;
            });

            const labels = Object.keys(estadosCivis);
            const values = Object.values(estadosCivis);
            const colors = ['#FF9800', '#9C27B0', '#E91E63', '#00BCD4', '#8BC34A'];

            new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: labels,
                    datasets: [{
                        data: values,
                        backgroundColor: colors.slice(0, labels.length),
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: `Distribui√ß√£o por Estado Civil - ${ano}`,
                            font: { size: 16, weight: 'bold' }
                        },
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                font: { size: 12 }
                            }
                        }
                    }
                }
            });
        }

        // Fun√ß√£o para criar gr√°fico de munic√≠pios individual
        function criarGraficoMunicipiosIndividual(canvasId, dados, ano) {
            const ctx = document.getElementById(canvasId);
            if (!ctx) return;

            const municipios = {};
            dados.forEach(row => {
                const municipio = row.NM_MUNICIPIO;
                const eleitores = parseInt(row.QT_ELEITORES_PERFIL);
                municipios[municipio] = (municipios[municipio] || 0) + eleitores;
            });

            const sortedMunicipios = Object.entries(municipios)
                .sort(([,a], [,b]) => b - a)
                .slice(0, 15);

            const labels = sortedMunicipios.map(([municipio]) => municipio);
            const values = sortedMunicipios.map(([, eleitores]) => eleitores);

            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: `Eleitores ${ano}`,
                        data: values,
                        backgroundColor: '#FF6384',
                        borderColor: '#E91E63',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    indexAxis: 'y',
                    plugins: {
                        title: {
                            display: true,
                            text: `Top 15 Munic√≠pios por N√∫mero de Eleitores - ${ano}`,
                            font: { size: 16, weight: 'bold' }
                        },
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        x: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return value.toLocaleString('pt-BR');
                                }
                            }
                        }
                    }
                }
            });
        }

        // Fun√ß√£o para criar gr√°fico de zonas individual
        function criarGraficoZonasIndividual(canvasId, dados, ano) {
            const ctx = document.getElementById(canvasId);
            if (!ctx) return;

            const zonas = {};
            dados.forEach(row => {
                const zona = `Zona ${row.NR_ZONA}`;
                const eleitores = parseInt(row.QT_ELEITORES_PERFIL);
                zonas[zona] = (zonas[zona] || 0) + eleitores;
            });

            const labels = Object.keys(zonas);
            const values = Object.values(zonas);

            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: `Eleitores ${ano}`,
                        data: values,
                        backgroundColor: '#9C27B0',
                        borderColor: '#7B1FA2',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: `Distribui√ß√£o por Zona Eleitoral - ${ano}`,
                            font: { size: 16, weight: 'bold' }
                        },
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return value.toLocaleString('pt-BR');
                                }
                            }
                        }
                    }
                }
            });
        }

        // Fun√ß√£o para configurar event listeners das abas
        function configurarEventListenersAbas() {
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const aba = btn.getAttribute('data-tab');
                    alternarAba(aba);
                });
            });
        }

        // Inicializar a aplica√ß√£o
        document.addEventListener('DOMContentLoaded', () => {
            carregarDados();
            // Configurar event listeners das abas ap√≥s o carregamento
            setTimeout(() => {
                configurarEventListenersAbas();
            }, 1000);
        });
    </script>
</body>
</html>
